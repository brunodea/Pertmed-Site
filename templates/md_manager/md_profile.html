{% extends "basic/base.html" %}

<link rel=Stylesheet href="/static/styles/md_profile.css" type="text/css">

{% block title %} {{ object.name }} - Perfil {% endblock %}

{% block style %}

.accordion 
{
    width: 75%;
    border: solid 1px #c4c4c4;
    margin: auto;
    margin-bottom: 5px;
}

.accordion .profile_item
{
    background: #e9e7e7 url(/static/images/arrow-square.gif) no-repeat right -51px;
    margin: auto;
    cursor: pointer;
    border-bottom: solid 1px #c4c4c4;
}

.accordion .profile_item:hover 
{
    background-color: #e3e2e2;
}

.accordion .profile_item.active 
{
    background-position: right 5px;
}

.accordion .profile_fields
{
    background: #f7f7f7;
    margin: 0;
    padding: 5px 1px 5px;
}

.accordion .profile_fields #pfs_field:hover
{
    background: #cfcfcf;
}

#profile_fields
{
    position: relative;
    width: 50%;
}

#profile_fields #phone
{
    margin-left: 20px;
    position: relative;
    text-align: left;
}

#profile_fields #phone:hover
{
    background: #cfcfcf;
}

#profile_fields field_title
{
    margin-left: 10px;
    font-size: 19px;
    position: relative;
    text-align: left;
}

.profile_change #button_add_phone
{
    position: relative;
    width: 16.5%;
    margin-left: 83.5%;
}

.profile_change #form_table #delete_phone
{
    cursor: pointer;
}

.profile_change #add_phone
{
    color: blue;
    cursor: pointer;
}

{% endblock %}


{% block script %}

    jQuery(document).ready(function(){
        $(".accordion .profile_item:first").addClass("active");
	    $(".accordion .profile_fields:not(:first)").hide();

	    $(".accordion .profile_item").click(function(){
	      $(this).next(".profile_fields").slideToggle("slow")
    	      .siblings(".profile_fields:visible").slideUp("slow");
	      $(this).toggleClass("active");
	      $(this).siblings(".profile_item").removeClass("active");
	    });
    });

    jQuery(document).ready(function(){
        {% if not phoneform_errors %}
            $(".profile_change").hide();
        {% else %}
            $(".profile").hide();
        {% endif %}

        $(".profile .profile_change_button").click(function(){ 
            $(".profile").hide();
            $(".profile_change").show();
        });
    });

    jQuery(document).ready(function(){
        $(".profile_change #add_phone").click(function(){
            var c = $(".profile_change #form_table tr:last").attr("id");
            var strs = c.split("_",3);
            c = parseInt(strs[1]) + 1;

            $(".profile_change #form_table > table:last")
            .append("<tr id='Phone_" + c + "_row'><td>Phone Number:</td><td><input id='id_Phone_" + c + 
                "' type='text' name='Phone_" + c + "' maxlength='10'></input></td>" + 
                "<td><img id='delete_phone' src='/static/images/X.png' alt='Delete Phone' /></td></tr>");

        });
    });

    jQuery(document).ready(function(){
        $(".profile_change #form_table #delete_phone").live('click', function(event) {
            var c = $(".profile_change #form_table tr").length - 1;

            if(c == 1) {
                jAlert("You must have at least one phone number.", "Alert");
            } 
            else {
                var id = $(this).parent().parent().attr("id");
                $(".profile_change #form_table #" + id).remove();
            }
        });
    });

{% endblock %}

{% block content %}
    
    <div class="profile">    
        <h2 align="center">{{ object.name }} - Profile</h2>

        {% if changed %}
            <p style="color: blue;" align="right">
                <script> 
                    jQuery(document).ready(function(){
                        jAlert("Profile changed with success!","Information");
                    });
                </script>
            </p>
        {% endif %}

        
        <div class="profile_change_button" align="right">
            <button type="button">Change Information</button>
        </div>   

        
        <hr width="45%" align="right" />

        <div id="profile_fields" align = "left">
            <field_title><strong> Registered Phones: </strong></field_title>
            {% for phone in object.phonenumber_set.all %}
                <div id="phone">
                    <strong>Phone Number:</strong>
                    ({{ phone.region }}){{ phone.phone }}
                </div>
            {% endfor %}
        </div>

        <br>

        <h3 align="left"> &nbsp; Informations you want to receive: </h3>
  
        <div class="accordion">
            {% for item, fields in object_itens_fields %}
                <div class="profile_item">
                    <strong>{{ item.name }}</strong>
                </div>
                <div class="profile_fields">
                    {% for field in fields %}
                        <div id="pfs_field">
                            {{ field.name }}   
                        </div>             
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
    </div>

    <div class="profile_change">
 
        {% if forms.errors %}
            <p style="color: red;">
                Please correct the error{{ forms.errors|pluralize }} below.
            </p>
        {% endif %}

        <form action="." method="POST">
        <!-- Token necessário para evitar a duplicação de informação enviada via formulário. -->
        {% csrf_token %}
        <div id="form_table">
            <table align="center" border="0">
            <!-- Renderiza o campo "Name" do formulário. -->
                <tr>
                    <td>{{ forms.name.label }}:</td><td>{{ forms.name }}</td>
                    <td><div class="profile_done_button"><input type="submit" value="Done" /></div></td>
                </tr>    

            <!-- Renderiza os campos "Phone Number" do formulário. -->
                {% for phone in phone_forms %}
                        {% if phone.errors %}
                           <tr id="{{phone.label}}_row"><td style="color: red;">{{ phone.errors }}</td></tr>
                        {% else %} 
                            {% for label, error_msg in phoneform_errors %}
                                {% if phone.label == label %}
                                    <tr id="{{phone.label}}_row"><td style="color: red;">{{ error_msg }}</td></tr>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    <tr id="{{phone.label}}_row">
                        <td>Phone Number:</td>
                        <td>{{ phone }}</td>
                        <td><img id="delete_phone" src="/static/images/X.png" alt="Delete Phone" /></td>
                    </tr> 
                {% endfor %}
            </table>
        </div>
        <center><img id="add_phone" src="/static/images/add.png" alt="Add Phone"/></center>

        <h3> &nbsp;  Select the data you want to receive: </h3>

        <!-- Laço que faz a renderização de todos os campos das informações que o médico gostaria de receber. -->
        <div class="accordion">
            {% for item, fields in info_forms %}
                <div class="profile_item">
                    <strong> {{ item }} </strong>
                </div>

                <div class="profile_fields">
                <table align="center">
                {% for label, info in fields %}
                    <tr><td> {{ label }}: </td><td> {{ info }} </td></tr>
                {% endfor %}
                </table>
                </div>
            {% endfor %}
        </div>

        </form>
    </div>

{% endblock %}

