{% extends "basic/base.html" %}

{% block style %}
    {{ block.super }}
    <link rel=Stylesheet href="/static/styles/md_profile.css" type="text/css">
{% endblock %}

{% block title %} {{ object.name }} - Perfil {% endblock %}

{% block script %}
    {{ block.super }}
    <script type="text/javascript">

        jQuery(document).ready(function(){
            $(".accordion .profile_item:first").addClass("active");
	        $(".accordion .profile_fields:not(:first)").hide();

	        $(".accordion .profile_item").click(function(){
	          $(this).next(".profile_fields").slideToggle("slow")
        	      .siblings(".profile_fields:visible").slideUp("slow");
	          $(this).toggleClass("active");
	          $(this).siblings(".profile_item").removeClass("active");
	        });

            {% if not phoneform_errors %}
                $(".profile_change").hide();
            {% else %}
                $(".profile").hide();
            {% endif %}

            $(".profile .profile_change_button").click(function(){ 
                $(".profile").hide();
                $(".profile_change").show();
            });

            $(".profile_change #add_phone").click(function(){
                var c = $(".profile_change #form_table tr:last").attr("id");
                var strs = c.split("_",3);
                c = parseInt(strs[1]) + 1;

                $(".profile_change #form_table > table:last")
                .append("<tr id='Phone_" + c + "_row'><td>Phone Number:</td><td><input id='id_Phone_" + c + 
                    "' type='text' name='Phone_" + c + "' maxlength='10'></input></td>" + 
                    "<td><img id='delete_phone' src='/static/images/X.png' alt='Delete Phone' width='15px' height='15px' /></td></tr>");

            });

            $(".profile_change #form_table #delete_phone").live('click', function(event) {
                var c = $(".profile_change #form_table tr").length - 1;

                if(c == 1) {
                    jAlert("You must have at least one phone number.", "Alert");
                } 
                else {
                    var id = $(this).parent().parent().attr("id");
                    $(".profile_change #form_table #" + id).remove();
                }
            });
        });

    </script>
{% endblock %}

{% block content %}
    
    <div class="profile">    
        <h2 align="center">{{ object.name }} - Profile</h2>

        {% if changed %}
            <p style="color: blue;" align="right">
                <script> 
                    jQuery(document).ready(function(){
                        jAlert("Profile changed with success!","Information");
                    });
                </script>
            </p>
        {% endif %}

        
        <div class="profile_change_button" align="right">
            <button type="button">Change Information</button>
        </div>   

        
        <hr width="45%" align="right" />

        <div id="profile_fields" align = "left">
            <field_title><strong> Registered Phones: </strong></field_title>
            {% for phone in object.phonenumber_set.all %}
                <div id="phone">
                    <strong>Phone Number:</strong>
                    ({{ phone.region }}){{ phone.phone }}
                </div>
            {% endfor %}
        </div>

        <br>

        <h3 align="left"> &nbsp; Informations you want to receive: </h3>
  
        <div class="accordion">
            {% for item, fields in object_itens_fields %}
                <div class="profile_item">
                    <strong>{{ item.name }}</strong>
                </div>
                <div class="profile_fields">
                    {% for field in fields %}
                        <div id="pfs_field">
                            {{ field.name }}   
                        </div>             
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
    </div>

    <div class="profile_change">

        <form action="." method="POST">
        <!-- Token necessário para evitar a duplicação de informação enviada via formulário. -->
        {% csrf_token %}
        <div id="form_table">

            <h2 align="center"> Modify your profile </h2>
            <div class="profile_done_button" align="right"><input type="submit" value="Done" /></div>
            
            <hr width="45%" align="right" />


            <table align="center" border="0">
            <!-- Renderiza o campo "Name" do formulário. -->
                <tr>
                    <td>{{ forms.name.label }}:</td><td>{{ forms.name }}</td>
                </tr>    

            <!-- Renderiza os campos "Phone Number" do formulário. -->
                {% for phone in phone_forms %}
                        {% if phone.errors %}
                           <tr id="{{phone.label}}_row"><td style="color: red;">{{ phone.errors }}</td></tr>
                        {% else %} 
                            {% if not phone.label in phoneform_success %}
                                {% for label, error_msg in phoneform_errors %}
                                    {% if phone.label == label %}
                                        <tr id="{{phone.label}}_row"><td style="color: red;">{{ error_msg }}</td></tr>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        {% endif %}
                    <tr id="{{phone.label}}_row">
                        <td>Phone Number:</td>
                        <td>{{ phone }}</td>
                        <td><img id="delete_phone" src="/static/images/X.png" alt="Delete Phone" width="15px" height="15px" /></td>
                    </tr> 
                {% endfor %}
            </table>
        </div>
        <center><img id="add_phone" src="/static/images/add.png" alt="Add Phone" width="16px" height="16px"/></center>

        <h3> &nbsp;  Select the data you want to receive: </h3>

        <!-- Laço que faz a renderização de todos os campos das informações que o médico gostaria de receber. -->
        <div class="accordion">
            {% for item, fields in info_forms %}
                <div class="profile_item">
                    <strong> {{ item }} </strong>
                </div>

                <div class="profile_fields">
                <table align="center">
                {% for label, info in fields %}
                    <tr><td> {{ label }}: </td><td> {{ info }} </td></tr>
                {% endfor %}
                </table>
                </div>
            {% endfor %}
        </div>

        </form>
    </div>

{% endblock %}

